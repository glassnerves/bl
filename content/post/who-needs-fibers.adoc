= Who needs fibers?
:revdate: 2021-01-25

:cpp: C++
:_:
:imagesdir: /

[ditaa,md_subs,title="The gateway subscription model"]
....
+--------------+
| WebSocket    |   TCP (initial snapshot + followup incrementals...)
| subscription | <-----+
+--------------+       |
                       |                 UDP   +----------+
+--------------+   TCP +- +---------+ <------- | Snapshot |
| WebSocket    | <------- | Gateway |          +----------+
| subscription |       +- | process | <-+
+--------------+       |  +---------+   | UDP  +-------------+
                       |                +----- | Incremental |
+--------------+   TCP |                       +-------------+
| WebSocket    | <-----+
| subscription |
+--------------+
....

[syntrax,hyperlinked,svg,opts=interactive]
....
jsyntrax(stack(
 line('attribute', '/(attribute) identifier', 'of'),
 line(choice(toploop('/entity_designator', ','), 'others', 'all'), ':'),
 line('/entity_class', 'is', '/expression', ';')
),
[
  'entity_class': 'https://www.google.com/#q=vhdl+entity+class',
  '(attribute) identifier': 'http://en.wikipedia.com/wiki/VHDL'
])
....

[vega, tasd, svg]
....
{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
   "title": "Body Mass of Penguin Species (g)",
  "data": {
    "values": [{
      "Species": "Adelie",
      "lower": 2850,
      "q1": 3350,
      "median": 3700,
      "q3": 4000,
      "upper": 4775,
      "outliers": []
    },{
      "Species": "Chinstrap",
      "lower": 2700,
      "q1": 3487.5,
      "median": 3700,
      "q3": 3950,
      "upper": 4800,
      "outliers": [2700,4800]
    },{
      "Species": "Gentoo",
      "lower": 3950,
      "q1": 4700,
      "median": 5000,
      "q3": 5500,
      "upper": 6300,
      "outliers": []
    }]
  },
  "encoding": {"y": {"field": "Species", "type": "nominal", "title": null}},
  "layer": [
    {
      "mark": {"type": "rule"},
      "encoding": {
        "x": {"field": "lower", "type": "quantitative","scale": {"zero": false}, "title": null},
        "x2": {"field": "upper"}
      }
    },
    {
      "mark": {"type": "bar", "size": 14},
      "encoding": {
        "x": {"field": "q1", "type": "quantitative"},
        "x2": {"field": "q3"},
        "color": {"field": "Species", "type": "nominal", "legend": null}
      }
    },
    {
      "mark": {"type": "tick", "color": "white", "size": 14},
      "encoding": {
        "x": {"field": "median", "type": "quantitative"}
      }
    },
    {
      "transform": [{"flatten": ["outliers"]}],
      "mark": {"type": "point", "style": "boxplot-outliers"},
      "encoding": {
        "x": {"field": "outliers", "type": "quantitative"}
      }
    }
  ]
}
----

[bytefield, lel3]
----
(draw-column-headers)
(draw-box 0x0f)
----

The execution engine will not crash. The only thing that will happen is a normal
Lua error being raised to the appropriate fiber call-stack.

Try to do the same with other fiber implementations to see if they also
hold out. Performance can always be improved later, but an incorrect application
is always an incorrect application and its advertised performance is useless.

I invested some serious effort into the design and implementation of cleanup
handlers to preserve program invariants. Emilua is designed for robustness
first, correctness above performance (honestly if I was worried about
performance, I'd be coding in C, not Lua).

If you find any crash on the execution engine, please report it and I'll take
the issue seriously (feature requests on the other hand may not receive my
attention in a timely manner).

[bytefield, lel, svg]
----
....
(draw-column-headers)
(draw-box 0x0f)
...
----
